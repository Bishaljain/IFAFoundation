import_from_git(url: 'https://github.com/marcelo-schroeder/IFAFastfile.git')

platform :ios do

  desc "Release new version of open source framework"
  desc "Optional parameter: versionNumber (if not provided, patch version number is incremented by 1)"
  lane :releaseFramework do |options|
    ensureGitBranch
    #updateDependencies
    #runAllTests
    updateVersionNumber(options)
    commitNewFrameworkVersionRelease
    addVersionGitTag
    pushToGitRemote
    gitMergeIntoRemoteMasterBranch
    pod_push
  end

  private_lane :commitNewFrameworkVersionRelease do
    sh "git add -A && git commit -m 'New version release'"
  end

  private_lane :gitMergeIntoRemoteMasterBranch do
    branchName = ENV['IFA_GIT_BRANCH']
    sh "git checkout master && git pull origin master && git merge #{branchName} && git push origin master && git checkout #{branchName} && git pull origin #{branchName}"
  end

  #private_lane :podTrunkPush do
  #  sh "cd .. && pod trunk push --verbose"
  #end

end